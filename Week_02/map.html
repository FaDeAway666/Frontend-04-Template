<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>map</title>
</head>
<style>
  body {
    font-size: 0px;
  }
  .cell {
    width: 6px;
    height: 6px;
    border-right: 1px solid white;
    border-bottom: 1px solid white;
    background-color: lightgray;
    display: inline-block;
    vertical-align: middle;
    line-height: 6px;
  }
  #container {
    width: 701px;
  }
</style>
<body>
  <div id="container"></div>
  <button onclick="save()">save</button>
</body>

<script>
  function save() {
    console.log('save');
    
    localStorage.setItem('map', JSON.stringify(map));
  }

  let container = document.getElementById('container');
  let map = localStorage.getItem('map') ? JSON.parse(localStorage.getItem('map')) : Array(10000).fill(0);
  for(let y=0; y<100; y++) {
    for(let x=0; x<100; x++) {
      let cell = document.createElement('div');
      cell.classList.add('cell');

      if(map[y*100 + x] == 1){
        cell.style.backgroundColor = 'black';
      }
      cell.addEventListener('mousemove', () => {
        if(mousedown) {
          if(clear) {
            map[y*100 + x] = 0;
            cell.style.backgroundColor = 'lightgray'
          } else {
            map[y*100 + x] = 1;
            cell.style.backgroundColor = 'black';
          }
        }
      })
      cell.addEventListener('click', () => {
        alert(map[y*100 + x]);
      })
      container.appendChild(cell);
    }
    // container.appendChild(document.createElement('br'))
  }

  let mousedown = false;
  let clear = false;
  document.addEventListener('mousedown', (e) => {
    mousedown = true;
    if(e.which == 3) clear = true;
  })
  document.addEventListener('mouseup', () => {
    mousedown = false
  });
  document.addEventListener('contextmenu',(e) => {e.preventDefault()})

  function sleep(timeout) {
    return new Promise((res,rej) => {
      setTimeout(() => {
        res();
      }, timeout);
    })
  }

  async function path(map, start, end) {
    var queue = [start];

    async function insert(x, y) {
      if( x >= 100 || y >= 100 || x < 0 || y < 0)
        return

      if(map[y*100 + x]) // 遇到墙或者节点已经走过
        return
      await sleep(30);
      container.children[y*100 + x].style.backgroundColor = 'red'
      map[y*100 + x] = 2;
      queue.push([x,y]);
    }

    while(queue.length){
      let [x, y] = queue.shift();
      if(x == end[0] && y == end[1])
        return true

      await insert(x-1, y);
      await insert(x, y-1);
      await insert(x+1, y);
      await insert(x, y+1);
    }
  }

  path(map, [0,0], [20,20])
</script>

</html>